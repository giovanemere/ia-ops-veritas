<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quality Analytics - IA-Ops Veritas</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .card { background: white; border-radius: 10px; padding: 20px; margin: 20px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #5a6fd8; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .metric-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .metric-value { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .metric-label { font-size: 1.1em; opacity: 0.9; }
        .chart-container { position: relative; height: 400px; margin: 20px 0; }
        .quality-indicator { display: inline-block; padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold; margin: 5px; }
        .quality-excellent { background: #27ae60; }
        .quality-good { background: #f39c12; }
        .quality-poor { background: #e74c3c; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìà Quality Analytics</h1>
        <p>An√°lisis de Calidad y M√©tricas - IA-Ops Veritas</p>
    </div>

    <div class="container">
        <div class="card">
            <h2>M√©tricas de Calidad</h2>
            <button onclick="loadMetrics()" class="btn">Actualizar M√©tricas</button>
            <div class="metrics-grid" id="metricsGrid">
                <!-- Metrics will be loaded here -->
            </div>
        </div>

        <div class="card">
            <h2>Tendencias de Calidad</h2>
            <div class="chart-container">
                <canvas id="trendsChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h2>Indicadores de Calidad</h2>
            <div id="qualityIndicators">
                <!-- Quality indicators will be loaded here -->
            </div>
        </div>

        <div class="card">
            <h2>Recomendaciones</h2>
            <div id="recommendations">
                <ul>
                    <li>Incrementar cobertura de pruebas en m√≥dulos cr√≠ticos</li>
                    <li>Revisar casos de prueba con mayor tasa de fallos</li>
                    <li>Optimizar tiempo de ejecuci√≥n de pruebas lentas</li>
                    <li>Implementar pruebas de regresi√≥n automatizadas</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8872/api';
        let trendsChart = null;

        async function loadMetrics() {
            try {
                const response = await fetch(`${API_BASE}/metrics`);
                const data = await response.json();
                
                const metricsGrid = document.getElementById('metricsGrid');
                metricsGrid.innerHTML = `
                    <div class="metric-card">
                        <div class="metric-value">${data.code_coverage}%</div>
                        <div class="metric-label">Code Coverage</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.test_pass_rate}%</div>
                        <div class="metric-label">Test Pass Rate</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.code_quality_score}/10</div>
                        <div class="metric-label">Quality Score</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.technical_debt}</div>
                        <div class="metric-label">Technical Debt</div>
                    </div>
                `;

                // Update quality indicators
                updateQualityIndicators(data);
                
            } catch (error) {
                console.error('Error loading metrics:', error);
            }
        }

        async function loadTrends() {
            try {
                const response = await fetch(`${API_BASE}/trends`);
                const data = await response.json();
                
                const ctx = document.getElementById('trendsChart').getContext('2d');
                
                if (trendsChart) {
                    trendsChart.destroy();
                }
                
                trendsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.dates,
                        datasets: [
                            {
                                label: 'Code Coverage (%)',
                                data: data.coverage_trend,
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Quality Score',
                                data: data.quality_trend,
                                borderColor: '#764ba2',
                                backgroundColor: 'rgba(118, 75, 162, 0.1)',
                                tension: 0.4,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Coverage (%)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Quality Score'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                }
                            }
                        }
                    }
                });
                
            } catch (error) {
                console.error('Error loading trends:', error);
            }
        }

        function updateQualityIndicators(metrics) {
            const indicators = document.getElementById('qualityIndicators');
            let html = '';
            
            // Coverage indicator
            if (metrics.code_coverage >= 80) {
                html += '<span class="quality-indicator quality-excellent">Excellent Coverage</span>';
            } else if (metrics.code_coverage >= 60) {
                html += '<span class="quality-indicator quality-good">Good Coverage</span>';
            } else {
                html += '<span class="quality-indicator quality-poor">Poor Coverage</span>';
            }
            
            // Quality score indicator
            if (metrics.code_quality_score >= 8) {
                html += '<span class="quality-indicator quality-excellent">High Quality</span>';
            } else if (metrics.code_quality_score >= 6) {
                html += '<span class="quality-indicator quality-good">Medium Quality</span>';
            } else {
                html += '<span class="quality-indicator quality-poor">Low Quality</span>';
            }
            
            // Pass rate indicator
            if (metrics.test_pass_rate >= 90) {
                html += '<span class="quality-indicator quality-excellent">Stable Tests</span>';
            } else if (metrics.test_pass_rate >= 75) {
                html += '<span class="quality-indicator quality-good">Moderate Stability</span>';
            } else {
                html += '<span class="quality-indicator quality-poor">Unstable Tests</span>';
            }
            
            indicators.innerHTML = html;
        }

        // Load data on page load
        loadMetrics();
        loadTrends();
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadMetrics();
            loadTrends();
        }, 30000);
    </script>
</body>
</html>
